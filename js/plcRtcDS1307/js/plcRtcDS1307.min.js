const ClassSensor=require("plcSensor.min.js");class ClassDS1307 extends ClassSensor{constructor(_opts,_sensor_props){ClassSensor.apply(this,[_opts,_sensor_props]),this._Name="ClassClassDS1307",this._Rtc=require("BaseClassDS1307.min.js").connect(_opts.bus),this._MinPeriod=100,this._UsedChannels=[],this._Interval,this.Init(_sensor_props)}static get ERROR_CODE_ARG_VALUE(){return 10}static get ERROR_MSG_ARG_VALUE(){return`ERROR>> invalid data. ClassID: ${this.name}`}Init(_sensor_props){super.Init(_sensor_props)}SetTime(_date){let newDate;if("string"==typeof _date&&/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/.test(str)){if(newDate=new Date(_date),!(newDate instanceof Date))throw new err(ClassDS1307.ERROR_MSG_ARG_VALUE,ClassDS1307.ERROR_CODE_ARG_VALUE)}else{if(!(_date instanceof Date))throw new err(ClassDS1307.ERROR_MSG_ARG_VALUE,ClassDS1307.ERROR_CODE_ARG_VALUE);newDate=_date}let year=newDate.getFullYear();year<2e3&&(year=2e3),year>2099&&(year=2099),newDate.getFullYear(year),this._Rtc.setTime(newDate)}AdjustTime(_val,_key){if(!Number.isInteger(_val)||"string"!=typeof _key)throw new err(ClassDS1307.ERROR_MSG_ARG_VALUE,ClassDS1307.ERROR_CODE_ARG_VALUE);let temp=this._Rtc.getTime("def"),_year=temp.getFullYear(),_month=temp.getMonth()+1,_day=temp.getDate(),_hour=temp.getHours(),_minute=temp.getMinutes(),_second=temp.getSeconds();switch(_key){case"yy":case"year":_val<2e3&&(_val=2e3),_val>2099&&(_val=2099),_year=_val;break;case"MM":case"month":_val<1&&(_val=1),_val>12&&(_val=12),_month=_val;break;case"dd":case"day":_val<1&&(_val=1),_val>31&&1&_month^_month>>3&1&&(_val=31),_val>30&&!(1&_month^_month>>3&1)&&(_val=30),_val>28&&2==_month&&(_val=date.year%4?28:29),_day=_val;break;case"hh":case"hours":_val<0&&(_val=0),_val>23&&(_val=23),_hour=_val;break;case"mm":case"minute":_val<0&&(_val=0),_val>59&&(_val=59),_minute=_val;break;case"ss":case"second":_val<0&&(_val=0),_val>59&&(_val=59),_second=_val;break;default:throw new err(ClassRTC.ERROR_MSG_ARG_VALUE,ClassRTC.ERROR_CODE_ARG_VALUE)}this._Rtc.setTime(new Date(_year,_month-1,_day,_hour,_minute,_second))}GetTimeISO(){let _res;return this._Rtc.getTime("iso")}GetTimeUnix(){let _res;return this._Rtc.getTime("unixtime")}GetTimeHMS(){let time=this._Rtc.getTime("def"),_res;return this._Rtc._leadZero(time.getHours())+":"+this._Rtc._leadZero(time.getMinutes())+":"+this._Rtc._leadZero(time.getSeconds())}Start(_num_channel,_period){let period="number"==typeof _period&_period>=this._MinPeriod?_period:this._MinPeriod;this._UsedChannels.includes(_num_channel)||this._UsedChannels.push(_num_channel),this._Interval||(this._Interval=setInterval(()=>{this._UsedChannels.includes(0)&&(this.Ch0_Value=this.GetTimeUnix()),this._UsedChannels.includes(1)&&(this.Ch1_Value=this.GetTimeISO()),this._UsedChannels.includes(2)&&(this.Ch2_Value=this.GetTimeHMS())},period))}ChangeFreq(_num_channel,freq){clearInterval(this._Interval),setTimeout(()=>this.Start(freq),this._Minfrequency)}Stop(_num_channel){_num_channel?this._UsedChannels.splice(this._UsedChannels.indexOf(_num_channel)):(this._UsedChannels=[],clearInterval(this._Interval),this._Interval=null)}}exports=ClassDS1307;