WHO_I_AM=129,STATUS_APP_REA=16,STATUS_DAT_REA=8,STATUS_FM_MODE=128,REG_STAT=0,REG_MEAS_MODE=1,REG_RES_DATA=2,REG_ENV_DATA=5,REG_BASELINE=17,REG_WHO_AM_I=32,REG_BOOTLOAD=244,REG_SOFT_RESET=255,MM_IDLE=0,MM_PER_1_SEC=16,MM_PER_10_SEC=32,MM_PER_60_SEC=48,MM_PER_250_MS=64;let AirQuality=function(bus,address,mode){this._i2c=bus||I2C1,this._address=address||90,this._mode=mode||1};AirQuality.prototype.writeI2C=function(reg,data){this._i2c.writeTo(this._address,[reg,data])},AirQuality.prototype.readI2C=function(reg,count){return void 0===count&&(count=1),this._i2c.writeTo(this._address,[reg,128]),this._i2c.readFrom(this._address,count)},AirQuality.prototype.init=function(){this.writeI2C(REG_SOFT_RESET,[17,229,114,138]),setTimeout(()=>{if(this.whoAmI()!==WHO_I_AM)throw"Failed 'WHO AM I' check!";if(!(this.readI2C(REG_STAT)&STATUS_APP_REA))throw"No application firmware loaded!";this.writeI2C(REG_BOOTLOAD,[]),setTimeout(()=>{if(!(this.readI2C(REG_STAT)&STATUS_FM_MODE))throw"Failed to boot firmware!";this.setMode(this._mode)},100)},100)},AirQuality.prototype.whoAmI=function(){return this.readI2C(REG_WHO_AM_I)[0]},AirQuality.prototype.getDriveMode=function(mode){switch(mode){case 0:return MM_IDLE;case 1:return MM_PER_1_SEC;case 2:return MM_PER_10_SEC;case 3:return MM_PER_60_SEC;case 4:return MM_PER_250_MS;default:throw"Invalid mode!"+mode}},AirQuality.prototype.setMode=function(mode){let drivemode=this.getDriveMode(mode);this._mode=mode,this.writeI2C(REG_MEAS_MODE,drivemode)},AirQuality.prototype.setEnvData=function(hum,temp){if(isNaN(hum))throw"CCS811 RH NaN!";if(isNaN(temp))throw"CCS811 Temp NaN!";if(!(hum>=0&&hum<=100))throw"CCS811 RH invalid!";let humiData=512*hum,tempData=512*(Math.max(-25,temp)+25),regData=[humiData>>8,255&humiData,tempData>>8,255&tempData];this.writeI2C(REG_ENV_DATA,regData)},AirQuality.prototype.get=function(){let data=this.readI2C(REG_RES_DATA,5),isNew=0!=(data[4]&STATUS_DAT_REA);return{eCO2:data[0]<<8|data[1],TVOC:data[2]<<8|data[3],new:isNew}},exports.connect=function(bus,address,mode){return new AirQuality(bus,address,mode)};