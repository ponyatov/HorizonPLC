let Rtc=function(i2c){this._time=void 0,i2c?this._i2c=i2c:(PrimaryI2C.setup({sda:SDA,scl:SCL,bitrate:1e5}),this._i2c=PrimaryI2C),this._address=104,this.start()};Rtc.prototype.write=function(reg,data){this._i2c.writeTo(this._address,[reg,data])},Rtc.prototype.read=function(reg,count){return void 0===count&&(count=1),this._i2c.writeTo(this._address,reg),this._i2c.readFrom(this._address,count)},Rtc.prototype._decToBcd=function(val){return 16*Math.floor(val/10)+val%10},Rtc.prototype._bcdToDec=function(val){return 10*Math.floor(val/16)+val%16},Rtc.prototype._leadZero=function(val){return val<10?"0"+val:""+val},Rtc.prototype.setTime=function(time){time instanceof Date?this._time=time:this._time=time instanceof Object?new Date(time.year,time.month-1,time.day,time.hour,time.minute,time.second):"number"==typeof time?new Date(1e3*time):"string"==typeof time?new Date(Date.parse(time)):new Date(1e3*getTime());let halt=this.read(0,1)[0]>>7;this.write(0,[this._decToBcd(this._time.getSeconds())|halt<<7,this._decToBcd(this._time.getMinutes()),this._decToBcd(this._time.getHours()),this._decToBcd(this._time.getDay()+1),this._decToBcd(this._time.getDate()),this._decToBcd(this._time.getMonth()+1),this._decToBcd(this._time.getFullYear()-2e3)])},Rtc.prototype.getTime=function(unit){let time=this.read(0,7);this._time=new Date(this._bcdToDec(time[6])+2e3,this._bcdToDec(time[5])-1,this._bcdToDec(time[4]),this._bcdToDec(63&time[2]),this._bcdToDec(time[1]),this._bcdToDec(127&time[0]));let res=this._time;switch(unit){case"unixtime":res=Math.ceil(res.getTime()/1e3);break;case"iso":res=res.getFullYear()+"-"+this._leadZero(res.getMonth()+1)+"-"+this._leadZero(res.getDate())+"T"+this._leadZero(res.getHours())+":"+this._leadZero(res.getMinutes())+":"+this._leadZero(res.getSeconds())}return res},Rtc.prototype.start=function(){let byte=this.read(0,1)[0];byte>>7&&this.write(0,128^byte)},Rtc.prototype.stop=function(){let byte=this.read(0,1)[0];byte>>7==0&&this.write(0,128^byte)},exports.connect=function(i2c){return new Rtc(i2c)};